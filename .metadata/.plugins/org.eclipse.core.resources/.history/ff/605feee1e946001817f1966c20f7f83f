package com.niit.SkillMap;

import static org.junit.Assert.*;

import java.util.Date;

import org.hibernate.exception.ConstraintViolationException;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.junit.jupiter.SpringJUnitConfig;
import org.springframework.test.context.junit4.SpringRunner;

import com.niit.SkillMap.Config.ApplicationContext;
import com.niit.SkillMap.Model.Employee;
import com.niit.SkillMap.Model.UserCredentials;
import com.niit.SkillMap.Service.EmployeeService;
@RunWith(SpringRunner.class)
@SpringJUnitConfig(classes=ApplicationContext.class)
public class EmployeeTest {



		@Autowired
		private EmployeeService employeeService;
		private Employee emp1,emp2;
		
		@Before
		public void setup() {
			if(employeeService.findEmployeesByName("Ram")!=null) {
				employeeService.deleteEmployee(employeeService.findEmployeesByName("Ram").getEmpId());
			}
			
			if(employeeService.findEmployeesByName("John")!=null) {
				employeeService.deleteEmployee(employeeService.findEmployeesByName("John").getEmpId());
			}
			
			if(employeeService.findEmployeesByName("Sam")!=null) {
				employeeService.deleteEmployee(employeeService.findEmployeesByName("Sam").getEmpId());
			}
			emp1=new Employee();
			//UserCredentials user=new UserCredentials();
			emp1.setEmpId(101);
			emp1.setEmpName("John");
			emp1.setEmpEmail("John@gmail.com");
			//user.setEmployeeId(emp1.getEmpId());
			//user.setEmployeeName(emp1.getEmpName());
			//user.setEmployeeName(emp1.getEmpName());
			emp1.setNoOfYears(5);
			emp1.setEmpType("Trainer");
			//user.setEmployeeType(emp1.getEmpType());
			emp1.setDateOfBirth(new Date(12/12/1990));
			emp1.setQualification("B.E");
			emp1.setPassword("niit@123");
			//user.setPassword(emp1.getPassword());
			emp1.setStatus("null");
			emp2=new Employee();
			emp2.setEmpId(102);
			emp2.setEmpName("Sam");
			emp2.setEmpEmail("Sam@gmail.com");
			//user.setEmployeeId(emp2.getEmpId());
			//user.setEmployeeName(emp2.getEmpName());
			//user.setEmployeeName(emp2.getEmpName());
			emp2.setNoOfYears(5);
			emp2.setEmpType("Trainer");
			//user.setEmployeeType(emp2.getEmpType());
			emp2.setDateOfBirth(new Date(12/12/1990));
			emp2.setQualification("B.E");
			emp2.setPassword("niit@123");
			//user.setPassword(emp2.getPassword());
			emp2.setStatus("null");
			employeeService.addEmployee(emp1);
			employeeService.addEmployee(emp2);
		}
		
		@After
		public void teardown() {
			
			employeeService.deleteEmployee(employeeService.findEmployeesByName("John").getEmpId());
			employeeService.deleteEmployee(employeeService.findEmployeesByName("Sam").getEmpId());
			if(employeeService.findEmployeesByName("Ram")!=null) {
				employeeService.deleteEmployee(employeeService.findEmployeesByName("Ram").getEmpId());
			}
			
		}
		
		
		@Test
		public void testAddEmployee() {
			
			Employee emp=new Employee();
			//UserCredentials user=new UserCredentials();
			emp.setEmpId(105);
			//user.setEmployeeId(emp.getEmpId());
			//user.setEmployeeName(emp.getEmpName());
			emp.setEmpName("Ram");
			//user.setEmployeeName(emp.getEmpName());
			emp.setEmpEmail("Ram@gmail.com");
			emp.setNoOfYears(5);
			emp.setEmpType("Trainer");
			//user.setEmployeeType(emp.getEmpType());
			emp.setDateOfBirth(new Date(12/12/1990));
			emp.setQualification("B.E");
			//emp.setPassword("niit@123");
			//user.setPassword(emp.getPassword());
			emp.setStatus("null");
			emp.setDateOfJoining(new Date(12/12/2016));
			assertEquals(true, employeeService.addEmployee(emp));
					
		}
		
		@Test
		public void testAddEmployeeFailure() {
			
			assertEquals(false, employeeService.addEmployee(emp1));
		}
		@Test
		public void testUpdateEmployee() {
			
			emp1.setEmpEmail("Sam12@gmail.com");
			emp1.setEmpType("Trainer");
			assertEquals(true, employeeService.updateEmployee(emp1));
					
		}
		@Test//"Trying to update primary key value EmpId"
		public void testUpdateEmployeeIdFailure() {
			
			Employee emp=new Employee();
			emp.setEmpId(111);
			assertEquals(false, employeeService.updateEmployee(emp));
					
		}
		@Test//"Trying to update Employee which is not in db"
		public void testUpdateEmployeeFailure() {
			
			Employee emp=new Employee();
			emp.setEmpEmail("xxx@gmail.com");
			assertEquals(false, employeeService.updateEmployee(emp));
					
		}
		@Test
		public void testDeleteEmployee() {
			
			
			Employee emp=new Employee();
			emp.setEmpEmail("xxx@gmail.com");
			emp.setEmpId(103);

			emp.setEmpName("xxX");
			emp.setNoOfYears(4);
			employeeService.addEmployee(emp);
			assertEquals(true, employeeService.deleteEmployee(emp.getEmpId()));
					
		}
		@Test
		public void testDeleteEmployeeFailure() {
			
			Employee emp=new Employee();
			
			assertEquals(false, employeeService.deleteEmployee(emp.getEmpId()));
					
		}
}